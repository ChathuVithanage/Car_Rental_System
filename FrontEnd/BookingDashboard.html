<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
  <link href="styleSheet.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3" crossorigin="anonymous"></script>
  <script src="https://code.jquery.com/jquery-3.6.1.min.js" integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous"></script>

  <style>

    @import url(https://fonts.googleapis.com/css?family=Open+Sans:400,500,300,700);
    @import url('https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Koulen&family=Lato&family=Nunito&family=Playfair+Display:ital@1&family=Prata&family=Raleway:ital,wght@1,100&family=Roboto&family=Roboto+Condensed&family=Teko&display=swap');


    .tx h7{
      color: red;
    }

    .modal-content{
      margin-left: -491px;
    }


    .modal {
      --bs-modal-margin: 1rem;
    }
    .card{
      width: 100%;
    }
    .modal-content{
      width: 1286px;
    }

    .row {
      --bs-gutter-x: 1.0 rem;
    }

    .nav-link h6:hover{
      color: firebrick;
    }

    .btnSign{
      font-family: Roboto, sans-serif;
      font-weight: 0;
      font-size: 14px;
      color: black;
      background-color: white;
      padding: 10px 30px;
      border: 2px solid gray;
      box-shadow: rgb(0, 0, 0) 0px 0px 0px 0px;
      border-radius: 50px;
      transition : 1000ms;
      transform: translateY(0);
      display: flex;
      flex-direction: row;
      align-items: center;
      cursor: pointer;
    }

    .btnSign:hover{

      transition : 1000ms;
      padding: 10px 50px;
      transform : translateY(-0px);
      background-color: #fff;
      color: firebrick;
      border: solid 2px red;
    }

    .btnLog {
      transition-duration: 0.4s;
      border-radius: 12px;
      border-color: #0066cc;
    }

    .btnLog:hover {
      background-color: royalblue; /* Green */
      color: white;
    }

    .about-list ul li i {
      margin-right: 7px;
      width: 20px;
      height: 20px;
      text-align: center;
      border-radius: 2px;
      background: #ec3323 none repeat scroll 0 0;
      color: #fff;
      line-height: 20px;
      font-size: 12px;
    }


    /* CSS */
    .btnLog{
      /*background-color: white;*/
      border: 2px;
      border-radius: 8px;
      color: wheat;
      cursor: pointer;
      display: inline-block;
      font-family: system-ui,-apple-system,system-ui,"Segoe UI",Roboto,Ubuntu,"Helvetica Neue",sans-serif;
      font-size: 13px;
      font-weight: 400;
      outline: 0;
      padding: 5px 10px;
      position: relative;
      text-align: center;
      transition: all .3s;
      user-select: none;
      -webkit-user-select: none;
      touch-action: manipulation;
    }

    .btnLog:before {
      background-color: initial;
      background-image: linear-gradient(#fff 0, rgba(255, 255, 255, 0) 100%);
      border-radius: 15px;
      content: "";
      height: 35%;
      left: 4%;
      opacity: .5;
      position: absolute;
      top: 0;
      transition: all .3s;
      width: 60%;
    }

    .btnLog:hover {
      box-shadow: rgba(255, 255, 255, .2) 0 3px 15px inset, rgba(0, 0, 0, .1) 0 3px 5px, rgba(0, 0, 0, .1) 0 10px 13px;
      transform: scale(1.05);
    }

    @media (min-width: 768px) {
      .btnLog{
        padding: 10px 40px;
      }
    }

    .car-card-img{
      width: 70px;
    }

    .btnSign{
      font-family: Roboto, sans-serif;
      font-weight: 0;
      font-size: 14px;
      color: black;
      background-color: white;
      padding: 10px 30px;
      border: 2px solid gray;
      box-shadow: rgb(0, 0, 0) 0px 0px 0px 0px;
      border-radius: 50px;
      transition : 1000ms;
      transform: translateY(0);
      display: flex;
      flex-direction: row;
      align-items: center;
      cursor: pointer;
    }






    /*.modal-content-1{*/
    /*  margin-left: -72px;*/
    /*}*/
  </style>


</head>
<body>

<!--<header class="header" id="header">-->
<!--  &lt;!&ndash; navigation bar &ndash;&gt;-->
<!--  <div class="navbar_1">-->
<!--    <img src="assest/classic-car.png" class="logo" >-->
<!--    <nav>-->
<!--      <ul>-->
<!--        <li><a href="#Home">Home</a></li>-->
<!--        <li><a href="#About">About</a></li>-->
<!--        <li><a href="#Car">Car</a></li>-->
<!--        <li>-->
<!--        <div class="dropdown" >-->
<!--          <a class="nav-link fw-bold text-decoration-underline btn btn-secondary dropdown-toggle" href="#" style="font-size: 17px; padding-left: 24px; padding-right: 18px; background-color: white" role="button" data-bs-toggle="dropdown" aria-expanded="false">Sign In</a>-->
<!--          <ul class="dropdown-menu">-->
<!--            <li><a class="dropdown-item" href="#" data-bs-target="#customerForm" data-bs-toggle="modal">Customer SignIn</a></li>-->
<!--            <li><a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#adminForm">Admin SignIn</a></li>-->
<!--&lt;!&ndash;                        <li><a class="dropdown-item" href="#">Something else here</a></li>&ndash;&gt;-->
<!--          </ul>-->
<!--        </div>-->
<!--        </li>-->

<!--      </ul>-->
<!--    </nav>-->
<!--  </div>-->

<!--</header>-->

<header class="sticky-top">
  <nav class="navbar navbar-expand-lg bg-body-tertiary " style="background-color: #2c3945; height: 55px; ">
    <img src="assest/classic-car.png" class="logo" style="width: 90px">
    <label style="width: 96px"><h5 style="color: yellow; text-shadow: 1px 1px 2px wheat, 0 0 25px white, 0 0 5px white;">Car Vista</h5></label>

    <div class="container-fluid">
      <a class="navbar-brand" href="#"></a>

      <div class="nav justify-content-end" id="navbarNavAltMarkup">
        <div class="navbar-nav">
          <a class="nav-link active fw-bold" aria-current="page" href="index.html" style=" padding-left: 18px; padding-right: 25px;color: white"><h6>Home</h6></a>
          <a class="nav-link fw-bold" href="" style=" padding-left: 18px; padding-right: 25px; color: white"><h6>Car</h6></a>
          <a class="nav-link fw-bold" href="index.html#aboutUs" style="padding-left: 18px; padding-right: 25px; color: white"><h6>About Us</h6></a>
          <a class="nav-link fw-bold" data-bs-target="#cusForm" data-bs-toggle="modal" data-backdrop="static" data-keyboard="false" href="#" style=" padding-left: 18px; padding-right: 25px; color: white"><h6>Customer SignIn</h6></a>

<!--          <button type="button" class="btnCusSign  mb-3" id="btnCusSignIn"  style="padding-left: 20px; padding-right: 20px"><h6 style="color: black; line-height: 0.88;">Customer Login</h6></button>-->

        </div>
      </div>

    </div>
  </nav>
</header>

<main class="bookingDashboard">
<!--Customer Login-->
  <form class="col-2 " id="AdminForms" >
    <div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" tabindex="-1" id="cusForm" >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header" style="background-color: #46b2ff ; padding-left: 45%">
            <h5 class="modal-title" id="exampleModalLabel2">LOG IN </h5>
            <button aria-label="Close" class="btn-close" data-bs-dismiss="modal" type="button"></button>
          </div>
          <div class="modal-body">
            <section>
              <div class="mb-3">

                <input class="form-control" id="txtCusLoginName" type="text" name="loginName" placeholder="Nic">
              </div>
              <div class="mb-3">

                <input class="form-control form-control-sm" id="txtCusLoginPassword" type="text" name="loginPassword" placeholder="Password">
              </div>
              <div class="mb-3">
                <div class="col" id="colA">
                  <a href="#!">Forget Password?</a>
                </div>
              </div>
              <div style="text-align: center">
                <button type="button" class=" btnLog btn-block mb-3" id="btnCusLogin" style="padding-left: 28px; padding-right: 28px"><a href="#"><h5 style=" line-height: 0.5;">Log In</h5></a></button>
              </div>

            </section>
          </div>
          <div class="modal-footer text-center">
            <p>
              "Not a member?"
              <a href="AdminRegistraion.html">Register</a>
            </p>
            <p>or sign up with:</p>
            <!--                        <button type="button" class="btn btn-link btn-floating mx-1"></button>-->
            <!--                        <button type="button" class="btn btn-link btn-floating mx-1"></button>-->
            <!--                        <button type="button" class="btn btn-link btn-floating mx-1"></button>-->
          </div>
        </div>
      </div>
    </div>
  </form>



<section class="bookingDashboard">

  <div class="line1" style="width: 100%; height: 30px; background-color: #b3d9ff"></div>
  <div class="tx" style="text-align: center">
  <h7>come with</h7>
  <h2>Hot Offers</h2>
  </div>


  <nav class="navbar navbar-expand-lg bg-body-tertiary">
    <div class="container-fluid">

      <div class="collapse navbar-collapse" id="navbarNavDropdown">
        <ul class="navbar-nav">
          <li class="nav-item dropdown">

            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              Brand
            </a>
            <ul class="dropdown-menu">
              <li><a class="dropdown-item" href="#">Toyota</a></li>
              <li><a class="dropdown-item" href="#">Suzuki</a></li>
              <li><a class="dropdown-item" href="#">BMW</a></li>
              <li><a class="dropdown-item" href="#">Mercedes Benz</a></li>
              <li><a class="dropdown-item" href="#">Perodua</a></li>
            </ul>
          </li>


          <li>
            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              Price
            </a>

            <ul class="dropdown-menu">
              <h7>Daily Rate</h7>
              <li><a class="dropdown-item" href="#">2500 - 5000</a></li>
              <li><a class="dropdown-item" href="#">5000 - 6000</a></li>
              <li><a class="dropdown-item" href="#">10000 -18000</a></li>

              <h7>Monthly Rate</h7>
              <li><a class="dropdown-item" href="#">64000 - 120000</a></li>
              <li><a class="dropdown-item" href="#">120000 - 180000</a></li>
              <li><a class="dropdown-item" href="#">200000 -300000</a></li>

            </ul>
          </li>

          <li>

            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              Fuel Type
            </a>
            <ul class="dropdown-menu">
              <li><a class="dropdown-item" href="#">Petrol</a></li>
              <li><a class="dropdown-item" href="#">Diesel</a></li>
            </ul>
          </li>

          <li>
            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              Passengers
            </a>
            <ul class="dropdown-menu">
              <li><a class="dropdown-item" href="#">2</a></li>
              <li><a class="dropdown-item" href="#">4</a></li>
              <li><a class="dropdown-item" href="#">6</a></li>
            </ul>
          </li>

          <li>
            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              Transmission
            </a>
            <ul class="dropdown-menu">
              <li><a class="dropdown-item" href="#">Manual</a></li>
              <li><a class="dropdown-item" href="#">Auto</a></li>
            </ul>
          </li>

          </li>
        </ul>
      </div>

    </div>
  </nav>

</section>

<section>

  <div class="row row-cols-4" id="cars" style="margin-left: 80px">


    <div class="col"></div>

    <div class="col">
      <div class="card" style="width: 18rem;">
        <img src="assest/blue-jeep-parking-public-zone.jpg" class="card-img-top" alt="...">
        <div class="card-body">
          <h5 class="card-title">eww</h5>
          <p class="card-text">Some quick example text to build on the card title and make up the bulk of the card's content.</p>
          <a href="#" class="btn btn-primary">Go somewhere</a>
        </div>
      </div>
    </div>

    <div class="col">
      <div class="card" style="width: 18rem;">
        <img src="assest/blue-jeep-parking-public-zone.jpg" class="card-img-top" alt="...">
        <div class="card-body">
          <h5 class="card-title">eww</h5>
          <p class="card-text">Some quick example text to build on the card title and make up the bulk of the card's content.</p>
          <a href="#" class="btn btn-primary">Go somewhere</a>
        </div>
      </div>
    </div>

    <div class="col">
      <div class="card" style="width: 18rem;">
        <img src="assest/blue-jeep-parking-public-zone.jpg" class="card-img-top" alt="...">
        <div class="card-body">
          <h5 class="card-title">eww</h5>
          <p class="card-text">Some quick example text to build on the card title and make up the bulk of the card's content.</p>
          <a href="#" class="btn btn-primary">Go somewhere</a>
        </div>
      </div>
    </div>

  </div>
  </div>

</section>

  <div class="container text-center">
<!--   booking-->
<!--    <div class="modal fade" id="BookingForms">-->
<!--    <form class="col-2 " >-->
      <div aria-hidden="true"  aria-labelledby="exampleModalLabel1" class="modal fade  bd-example-modal-lg" id="BookingForm" tabindex="-1"
           >
        <div class="modal-dialog position-absolute" style="margin-left: 38rem;">
          <div class="modal-content">
            <div class="modal-header" style="background-color: #2c3e50;">
              <h5 class="modal-title" style="color: white" id="exampleModalLabel1">Booking now... </h5>
              <button aria-label="Close" class="btn-close" data-bs-dismiss="modal" type="button"></button>
            </div>

            <!--booking-->
            <div class="tab-content " id="pills-tabContent" >
              <div class="tab-pane fade show active" id="pills-home" role="tabpanel"
                   aria-labelledby="pills-home-tab"
                   tabindex="0">
                <section class="vh-140" style="background-color:slategray">
                  <div class="container h-100">
                    <div class="row d-flex justify-content-center align-items-center h-100 p-4">
                      <div class="col-xl-9">

                        <div class="card" style="border-radius: 15px;">
                          <div class="card-body">

                            <div class="row align-items-center pt-4 pb-3">

                            <div class="line1" style="width: 100%; height: 35px; background-color:  #b3cccc"><h5> Start Booking...</h5></div>
                            <div class="line2" style="width: 100%; height: 30px; background-color: white"></div>

                            <h1><span class="brand" id="brand">Toyota</span> <span class="model" id="model">model</span></h1>
                              <div class="line2" style="width: 100%; height: 30px; background-color: white"></div>
                              <h2><span class="vehicleNo" id="vehicleNo">2020</span></h2>

                              <div class="line2" style="width: 100%; height: 30px; background-color: white"></div>
                              <div class="row">

                                <div class="row col-3">
                                  <label style="background-color: darkgray">mileage</label>
                                  <span class="mileage" id="mileage">1000</span>
                                </div>
                                <div class="row col-3">
                                  <label>transmission</label>
                                  <span class="mileage" id="transmission">auto</span>
                                </div>
                                <div class="row col-3">
                                  <label style="background-color: darkgray">seat</label>
                                  <span class="seat" id="passengers">4</span>
                                </div>
                                <div class="row col-3">
                                  <label>Fuel</label>
                                  <span class="fuel" id="fuelType">Petrol</span>
                                </div>

                              </div>

                              <div class="line2" style="width: 100%; height: 30px; background-color: white"></div>

                              <div class="row">

                                <div class="row col-4">
                                  <label>Free km per Day</label>
                                  <span class="freeKmDay" id="freeMileageForDay">10</span>
                                </div>
                                <div class="row col-4">
                                  <label style="background-color: darkgray">Free km per Month</label>
                                  <span class="freeKmMonth" id="freeMileageForMonth">3000</span>
                                </div>
                                <div class="row col-4">
                                  <label>Type</label>
                                  <span class="type" id="type">Luxury</span>
                                </div>

                              </div>

                              <div class="line2" style="width: 100%; height: 30px; background-color: white"></div>

                              <div class="row">

                                <div class="row col-4">
                                  <label style="background-color: darkgray">Price for extra km</label>
                                  <span class="extraKm" id="extraPrice">5000</span>
                                </div>
                                <div class="row col-4">
                                  <label>Daily Rate</label>
                                  <span class="dailyRate" id="dailyRate">3000</span>
                                </div>
                                <div class="row col-4">
                                  <label style="background-color: darkgray">Monthly Rate</label>
                                  <span class="monthlyRate" id="monthlyRate">50000</span>
                                </div>

                              </div>

                              <div class="line2" style="width: 100%; height: 30px; background-color: white"></div>
                              <hr>
                              <div class="line2" style="width: 100%; height: 30px; background-color: white"></div>

                              <label style="background-color: #16a085">Customer</label>

                              <div class="line2" style="width: 100%; height: 30px; background-color: white"></div>

                              <label><h5>select date</h5></label>

                              <div class="line2" style="width: 100%; height: 30px; background-color: white"></div>

                              <div class="mb-3">

                                <input class="form-control" id="txtBookinId" type="text" name="bookingId" placeholder="B-XXXX">
                              </div>

                              <div class="row">

                                <div class="row col-6" style="padding: 5px">
                                  <label style="padding: 6px">Check in</label>
                                  <div class="input-group flex-nowrap">
                                    <input type="date" class="form-control datepicker" placeholder="Date" aria-label="Date" aria-describedby="addon-wrapping" name="currentDate" id="currentDate">
                                  </div>
                                </div>

                                <div class="row col-6" style="padding: 5px">
                                  <label style="padding: 6px">Check out</label>
                                  <div class="input-group flex-nowrap">
                                    <input type="date" class="form-control datepicker" placeholder="Date" aria-label="Date" aria-describedby="addon-wrapping" name="dueDate" id="dueDate">
                                  </div>
                                </div>

                              </div>

                              <div class="line2" style="width: 100%; height: 30px; background-color: white"></div>

                              <div class="row">
                              <label>luxury :</label>
                                <h6><span id="advancePayment">2000</span></h6>
                              </div>

                              <div class="col-6">
                              <label style="text-align: left; padding: 10px">conform payment by uploading slip</label>
                              <div class="input-group flex-nowrap">
                                <input type="file" class="form-control" placeholder="paymentConfirmation" aria-label="paymentConfirmation" aria-describedby="addon-wrapping" name="paymentConfirmation" id="paymentConfirmation">
                              </div>
                              </div>

                              <div class="line2" style="width: 100%; height: 30px; background-color: white"></div>

                              <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="" id="driverCheck">
                                <label class="form-check-label" for="driverCheck">
                                  Driver
                                </label>
                              </div>

                              <div class="line2" style="width: 100%; height: 30px; background-color: white"></div>

                              <div class="tot">
                                <h5 style="padding: 15px">Total :</h5>
                                <h4><span id="total">3000</span></h4>

                              </div>


                              <button type="button" class="btn btn-outline-dark" style="width: 145px" id="btnBooking">submit</button>


                            </div>

                          </div>

                          <div class="row" style="height: 10vh"></div>

                        </div>
                      </div>
                    </div>
                  </div>

                </section>
              </div>
            </div>
          </div>
        </div>
      </div>
  </div>

</section>
</main>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-3.6.1.min.js" integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-/bQdsTh/da6pkI1MST/rWKFNjaCP5gBSY4sEBT38Q/9RBh9AH40zEOg7Hlq2THRZ" crossorigin="anonymous"></script>
</body>

<script>


  let baseUrl = "http://localhost:8080/Car_Rental_System_war/"
  sessionStorage.setItem('customer', false)

  let loginCustomer=null;
  let driver = null;

  console.dir(sessionStorage.getItem('customer'))

  $('#btnCusLogin').click(async function (e){
    e.preventDefault()
    alert("login btn");

    let userName = $('#txtCusLoginName').val();
    let password = $('#txtCusLoginPassword').val();
    console.log(userName,password)

    let cus = await findCustomerObj(userName);
    console.log("cus Obj ")
    console.log(cus);

    // loggedCus=cus.nic;
    // console.log("logged cus"+ loggedCus);

    if (password===cus.password){
      // sessionStorage.setItem('customer', true)
      loginCustomer = cus
      alert("Successfully logged");
      // window.location.href = "BookingDashboard.html"
    }

    // $('#profileCard').empty()
    // var profileCard = '<h4 class="card-title">' + cus.name +'</h4>\n' +
    //     '                            <p class="mb-sm-1"><b>NIC:</b>' + cus.nic +'</p>\n' +
    //     '                            <p class="mb-sm-1"><b>Address:</b>' + cus.address +'</p>\n' +
    //     '                            <p class="mb-sm-1"><b>License :</b>' + cus.license +'</p>\n' +
    //     '                            <p class="mb-sm-1"><b>Contact :</b>' + cus.contact +'</p>'
    //
    // $('#profileCard').append(profileCard);
  });
  //
  //
  //
  function findCustomerObj(userName){
    // alert("find cus Obj")

    let response="";
    $.ajax({
      url: baseUrl+"customer?nic="+userName,
      dataType:"json",
      async:false,
      success:function (res) {
        console.log("success : "+userName);
        if(res.data.nic===userName){
          response= res.data;
        }

      }
    })
    return response;
  }


  function loadAllCarsForSelection() {
    $("#cars").empty();
    $.ajax({
      url: baseUrl + "car/getAll",
      dataType: "json",
      success: function (resp) {
        console.log(resp.data);
        resp.data.forEach((car) => {
          let {
            brand,
            model,
            fuelType,
            monthlyRate,
            dailyRate,
            vehicleNo,
            img_front
          } = car;
          $("#cars").append(

                 ' <div class="col"> ' +
                   ' <div class="card" style="width: 18rem;"> ' +

                  `<img src="data:image/png;base64, ${img_front}" class='car-card-img'>`+
                        '<div class="card-body"> ' +
                          '<h5 class="card-title">' +brand +" "+ model + '</h5> '+
                          '<h5 class="card-title"> Vehicle No :' +
                          '<span id="regNo">' + vehicleNo + '</span>'+
                          '</h5> '+
                          '<p class="card-text">' +fuelType+ '</p>' +
                          '<p class="card-text">dailyRate : ' +monthlyRate+ '</p>' +
                          '<p class="card-text">monthlyRate :' +dailyRate+ '</p>' +
                          '<button type="button"  class="btn btn-primary choose">booking</a>' +
                        '</div>'+
                    '</div>' +
                  '</div>'

        );
        });


        // button functionalities
        $(".choose").click(function (e) {
          // is user is logged in
          // e.preventDefault()
          console.log(sessionStorage.getItem('customer'))
          if (loginCustomer) {
            // $(e.target).attr("data-bs-target","#BookingForm")

            let regNo = $(this)
                    .parent().find("span#regNo")
                    .text();
            $.ajax({
              url: baseUrl + "car/find?vehicleNo=" + regNo,
              method: "get",
              dataType: "json",
              success: function (res) {
                let car = res.data;
                $("#BookingForm span[id]").each(function () {
                  $(this).text(car[$(this).attr("id")]);
                });
                let advance = 0.0;
                switch (car.type) {
                  case "General":
                    advance = 10000.0;
                    break;
                  case "Premium":
                    advance = 15000.0;
                    break;
                  case "Luxury":
                    advance = 20000.0;
                    break;
                }
                $("span#advancePayment").text(advance);
                $("#BookingForm").modal('show')
                // changeActiveTab("#car-single-selection");
              },
              error: function () {
                return null;
              },
            });
          } else {
            // $("#BookingForm").hide()
            alert("please Login to proceed!");
          }
        });
      },
    });
  }

  loadAllCarsForSelection();
  function calDays() {
    let startDay = new Date($("#currentDate").val());
    let endDay = new Date($("#dueDate").val());
    var millisBetween = startDay.getTime() - endDay.getTime();
    return (totalDays = Math.round(
            Math.abs(millisBetween / (1000 * 3600 * 24))
    ));
  }
  $("#currentDate").change(calculateValueOnDateChange)
  $("#dueDate").change(calculateValueOnDateChange)

  function calculateValueOnDateChange() {
    // validating date
    let startDay = new Date($("#currentDate").val());
    let endDay = new Date($("#dueDate").val());
    let today = Date.now();
    let total = 0.0;
    if (startDay & endDay) {
      if ((startDay < endDay) & (startDay > today)) {
        try {
          var millisBetween = startDay.getTime() - endDay.getTime();
        } finally {
          let totalDays = Math.round(
                  Math.abs(millisBetween / (1000 * 3600 * 24))
          );
          let dailyRate = parseInt($("span#dailyRate").text());
          if (totalDays >= 30) {
            let monthlyRate = parseInt($("span#monthlyRate").text());
            let months = Math.round(totalDays / 30);
            let days = totalDays % 30;
            total += days * dailyRate + months * monthlyRate;
          } else {
            total += dailyRate * totalDays;
          }
          $("#driverCheck").removeAttr("disabled");
          // checking out
          if ($("#driverCheck").is(":checked")) {
            $("#driverCheck").prop("checked", false);
          }
        }
        $("span#total").text(total);
      } else {
        alert("invalid date selection, please check again");
        $(".datepicker").val("");
        $("span#total").text("");
        $("#driverCheck").prop("checked", false);
      }
    }
  }

  $("#btnBooking").click(function () {
    // var user,
    //         driver = {};
    // if ($.cookie("userLoggedIn")) {
    //   user = cookieTable["user"];
    //   console.dir(user);
    // }
    // if ($.cookie("driverAssigned")) {
    //   driver = cookieTable["driver"];
    //   console.dir(driver);
    // }
    var formData = new FormData();
    formData.append(
            "advancePayment",
            parseFloat($("span#advancePayment").text())
    );

    // let id = await generateNextId();
    formData.append("isAccepted", false);
    formData.append("bookingId", $("#txtBookinId").val());
    formData.append("rent", parseFloat($("span#total").text()));
    formData.append("dueDateTime", $("#dueDate").val());
    formData.append("currentDateTime", $("#currentDate").val());
    formData.append("car", $("span#vehicleNo").text());
    formData.append("driver", driver.license);
    formData.append("user", loginCustomer.nic);
    formData.append(
            "paymentConfirmation",
            $("input#paymentConfirmation")[0].files[0]
    );
    $.ajax({
      url: baseUrl + "booking/place",
      method: "post",
      data: formData,
      dataType: "json",
      success: function (res) {
        alert(res.message);
        // loadAllBookingsForUser(user.username);
      },
      error: function (error) {
        // var jsObject = JSON.parse(error.responseText);
        // alert(jsObject.message);
      },
      processData: false,
      contentType: false,
    });
  })

  // add a driver randomly
  $("input#driverCheck").change(function () {
    if ($(this).is(":checked")) {
      // get a driver randomly
      date1 = $("#currentDate").val();
      date2 = $("#dueDate").val();
      $.ajax({
        url: baseUrl + "driver/findRandom",
        method: "get",
        data: "date1=" + date1 + "&date2=" + date2,
        dataType: "json",
        success: function (res) {
          driver = res.data;
          console.log(driver)
          // $.cookie("driverAssigned", true, { path: "/" });
          // cookieTable.driver = res.data;
          // setting values
          // $("#driver-details span[id]").each(function () {
          //   $(this).text(driver[$(this).attr("id")]);
          // });
          let total = parseInt($("span#total").text());
          total += calDays() * 1000;
          $("span#total").text(total);
        },
        error: function () {
          return null;
        },
      });
    } else {
      // $.cookie("driverAssigned", false, { path: "/" });
      // $.cookie("driver", null);
      // $("#driver-details span[id]").each(function () {
      //   $(this).text("");
      // });
    }
  });

  // $('#btnBooking').click(function () {
  //   alert(vehicleNo);
  //   let bookingID = "";
  //   console.log(bookingID);
  //   let currentDate = $('#currentDate').val();
  //   let dueDate = $('#dueDate').val();
  //   let advancePayment = 20000;
  //   let isAccepted = "false";
  //   let car = ca[0];
  //   let d = findDriver();
  //   console.log("find");
  //   let driver = d[1];
  //   console.log(d);
  //   console.log(driver);
  //
  //   console.log("loggedcus 2"+loggedCus)
  //   /*let driver = "D001"*/
  //   /*let cus = searchCustomerByUserName(loginCustomer);*/
  //   /*let customer = cus[0];*/
  //
  //   /*let cus = findCustomer();*/
  //   let cus = findCustomerObj(loggedCus);
  //   let customer = cus[0];
  //   console.log(cus);
  //   console.log(customer);
  //
  //   var book = {
  //     bookingID: bookingID,
  //     currentDate: currentDate,
  //     dueDate: dueDate,
  //     advancePayment: advancePayment,
  //     isAccepted: isAccepted,
  //     car: car,
  //     driver: driver,
  //     customer: cus
  //   }
  //   console.log("book");
  //   console.log(book);
  //
  //   $.ajax({
  //     url: baseUrl + "booking",
  //     method: "post",
  //     contentType: "application/json",
  //     data: JSON.stringify(book),
  //     dataType: "json",
  //     success: function (res) {
  //       alert("success booking" + res.message);
  //
  //     },
  //     error: function (error) {
  //       let cause = JSON.parse(error.responseText).message;
  //       alert(cause);
  //     }
  //   })
  // });
  //
  // function findCustomerObj(userName){
  //   alert("find cus Obj")
  //
  //   let response="";
  //   $.ajax({
  //     url: baseUrl+"customer?nic="+userName,
  //     dataType:"json",
  //     async:false,
  //     success:function (res) {
  //       console.log("success : "+userName);
  //       res.data.filter((c)=>{
  //
  //         console.log("username :"+c.nic);
  //         console.log("password :"+c.password);
  //         console.log("password :"+c.name);
  //
  //         if (c.nic==userName){
  //           response= c;
  //         }
  //
  //         console.log(response);
  //
  //       });
  //
  //     }
  //   })
  //   return response;
  // }

$("#cusLogin").click(function () {
  $('#customerForm').modal('toggle');
})

  $('#customerForm').modal({backdrop: 'static', keyboard: false}, 'show');


  $(".btn-close").on("click",()=>{$('.modal-backdrop').remove()})

</script>

</body>
</html>