<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
  <link href="styleSheet.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3" crossorigin="anonymous"></script>
  <script src="https://code.jquery.com/jquery-3.6.1.min.js" integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous"></script>

  <style>
    .tx h7{
      color: red;
    }

    .modal-content{
      margin-left: -491px;
    }

    .navbar_1 {
      position: fixed;
      height: 40px;
      top: 0;
      left: 0;
      width: 100%;
      height: 52px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      background-color: #2c3945;
      z-index: 1;
      box-shadow: 0px -1px 8px 2px #1c1717e8;
    }

    body{
      z-index: 0;
    }
    .logo{
      width: 80px;
      height: 65px;
      cursor: pointer;
      left: 15%;
    }
    nav{
      display: inline;
    }
    ul {
      height: 100%;
      overflow: hidden;
    }
    nav ul li{
      padding: 11px 20px;
      display: inline-block;
      list-style-type: none;
      height: 100%;
    }
    nav ul li a{
      text-decoration: none;
      color: white;
      font-weight: bold;
    }
    nav ul li a:hover{
      color: deeppink;
    }

    .modal {
      --bs-modal-margin: 1rem;
    }
    .card{
      width: 100%;
    }
    .modal-content{
      width: 1286px;
    }

    .row {
      --bs-gutter-x: 1.0 rem;
    }

    /*.modal-content-1{*/
    /*  margin-left: -72px;*/
    /*}*/
  </style>


</head>
<body>

<header class="header" id="header">
  <!-- navigation bar -->
  <div class="navbar_1">
    <img src="assest/classic-car.png" class="logo" >
    <nav>
      <ul>
        <li><a href="#Home">Home</a></li>
        <li><a href="#About">About</a></li>
        <li><a href="#Car">Car</a></li>
        <li>
        <div class="dropdown" >
          <a class="nav-link fw-bold text-decoration-underline btn btn-secondary dropdown-toggle" href="#" style="font-size: 17px; padding-left: 24px; padding-right: 18px; background-color: white" role="button" data-bs-toggle="dropdown" aria-expanded="false">Sign In</a>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="#" data-bs-target="#customerForm" data-bs-toggle="modal">Customer SignIn</a></li>
            <li><a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#adminForm">Admin SignIn</a></li>
<!--                        <li><a class="dropdown-item" href="#">Something else here</a></li>-->
          </ul>
        </div>
        </li>

      </ul>
    </nav>
  </div>

</header>


<section class="bookingDashboard">

  <div class="line1" style="width: 100%; height: 30px; background-color: #b3d9ff"></div>
  <div class="tx" style="text-align: center">
  <h7>come with</h7>
  <h2>Hot Offers</h2>
  </div>


  <nav class="navbar navbar-expand-lg bg-body-tertiary">
    <div class="container-fluid">

      <div class="collapse navbar-collapse" id="navbarNavDropdown">
        <ul class="navbar-nav">
          <li class="nav-item dropdown">

            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              Brand
            </a>
            <ul class="dropdown-menu">
              <li><a class="dropdown-item" href="#">Toyota</a></li>
              <li><a class="dropdown-item" href="#">Suzuki</a></li>
              <li><a class="dropdown-item" href="#">BMW</a></li>
              <li><a class="dropdown-item" href="#">Mercedes Benz</a></li>
              <li><a class="dropdown-item" href="#">Perodua</a></li>
            </ul>
          </li>


          <li>
            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              Price
            </a>

            <ul class="dropdown-menu">
              <h7>Daily Rate</h7>
              <li><a class="dropdown-item" href="#">2500 - 5000</a></li>
              <li><a class="dropdown-item" href="#">5000 - 6000</a></li>
              <li><a class="dropdown-item" href="#">10000 -18000</a></li>

              <h7>Monthly Rate</h7>
              <li><a class="dropdown-item" href="#">64000 - 120000</a></li>
              <li><a class="dropdown-item" href="#">120000 - 180000</a></li>
              <li><a class="dropdown-item" href="#">200000 -300000</a></li>

            </ul>
          </li>

          <li>

            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              Fuel Type
            </a>
            <ul class="dropdown-menu">
              <li><a class="dropdown-item" href="#">Petrol</a></li>
              <li><a class="dropdown-item" href="#">Diesel</a></li>
            </ul>
          </li>

          <li>
            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              Passengers
            </a>
            <ul class="dropdown-menu">
              <li><a class="dropdown-item" href="#">2</a></li>
              <li><a class="dropdown-item" href="#">4</a></li>
              <li><a class="dropdown-item" href="#">6</a></li>
            </ul>
          </li>

          <li>
            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              Transmission
            </a>
            <ul class="dropdown-menu">
              <li><a class="dropdown-item" href="#">Manual</a></li>
              <li><a class="dropdown-item" href="#">Auto</a></li>
            </ul>
          </li>

          </li>
        </ul>
      </div>

    </div>
  </nav>

</section>

<section>

  <div class="row row-cols-4" id="cars" style="margin-left: 80px">


    <div class="col"></div>

    <div class="col">
      <div class="card" style="width: 18rem;">
        <img src="assest/blue-jeep-parking-public-zone.jpg" class="card-img-top" alt="...">
        <div class="card-body">
          <h5 class="card-title">eww</h5>
          <p class="card-text">Some quick example text to build on the card title and make up the bulk of the card's content.</p>
          <a href="#" class="btn btn-primary">Go somewhere</a>
        </div>
      </div>
    </div>

    <div class="col">
      <div class="card" style="width: 18rem;">
        <img src="assest/blue-jeep-parking-public-zone.jpg" class="card-img-top" alt="...">
        <div class="card-body">
          <h5 class="card-title">eww</h5>
          <p class="card-text">Some quick example text to build on the card title and make up the bulk of the card's content.</p>
          <a href="#" class="btn btn-primary">Go somewhere</a>
        </div>
      </div>
    </div>

    <div class="col">
      <div class="card" style="width: 18rem;">
        <img src="assest/blue-jeep-parking-public-zone.jpg" class="card-img-top" alt="...">
        <div class="card-body">
          <h5 class="card-title">eww</h5>
          <p class="card-text">Some quick example text to build on the card title and make up the bulk of the card's content.</p>
          <a href="#" class="btn btn-primary">Go somewhere</a>
        </div>
      </div>
    </div>

  </div>
  </div>

</section>

  <div class="container text-center">
<!--   booking-->
<!--    <div class="modal fade" id="BookingForms">-->
<!--    <form class="col-2 " >-->
      <div aria-hidden="true"  aria-labelledby="exampleModalLabel1" class="modal fade  bd-example-modal-lg" id="BookingForm" tabindex="-1"
           >
        <div class="modal-dialog position-absolute" style="margin-left: 38rem;">
          <div class="modal-content">
            <div class="modal-header" style="background-color: #2c3e50;">
              <h5 class="modal-title" style="color: white" id="exampleModalLabel1">Booking now... </h5>
              <button aria-label="Close" class="btn-close" data-bs-dismiss="modal" type="button"></button>
            </div>

            <!--booking-->
            <div class="tab-content " id="pills-tabContent" >
              <div class="tab-pane fade show active" id="pills-home" role="tabpanel"
                   aria-labelledby="pills-home-tab"
                   tabindex="0">
                <section class="vh-140" style="background-color:slategray">
                  <div class="container h-100">
                    <div class="row d-flex justify-content-center align-items-center h-100 p-4">
                      <div class="col-xl-9">

                        <div class="card" style="border-radius: 15px;">
                          <div class="card-body">

                            <div class="row align-items-center pt-4 pb-3">

                            <div class="line1" style="width: 100%; height: 35px; background-color:  #b3cccc"><h5> Start Booking...</h5></div>
                            <div class="line2" style="width: 100%; height: 30px; background-color: white"></div>

                            <h1><span class="brand" id="brand">Toyota</span> <span class="model" id="model">Toyota</span></h1>
                              <div class="line2" style="width: 100%; height: 30px; background-color: white"></div>
                              <span class="vehicleNo" id="vehicleNo">Toyota</span>

                              <div class="line2" style="width: 100%; height: 30px; background-color: white"></div>
                              <div class="row">

                                <div class="row col-3">
                                  <label style="background-color: darkgray">mileage</label>
                                  <span class="mileage" id="mileage">1000</span>
                                </div>
                                <div class="row col-3">
                                  <label>transmission</label>
                                  <span class="mileage" id="transmission">auto</span>
                                </div>
                                <div class="row col-3">
                                  <label style="background-color: darkgray">seat</label>
                                  <span class="seat" id="passengers">4</span>
                                </div>
                                <div class="row col-3">
                                  <label>Fuel</label>
                                  <span class="fuel" id="fuelType">Petrol</span>
                                </div>

                              </div>

                              <div class="line2" style="width: 100%; height: 30px; background-color: white"></div>

                              <div class="row">

                                <div class="row col-4">
                                  <label>Free km per Day</label>
                                  <span class="freeKmDay" id="freeMileageForDay">10</span>
                                </div>
                                <div class="row col-4">
                                  <label style="background-color: darkgray">Free km per Month</label>
                                  <span class="freeKmMonth" id="freeMileageForMonth">3000</span>
                                </div>
                                <div class="row col-4">
                                  <label>Type</label>
                                  <span class="type" id="type">Luxury</span>
                                </div>

                              </div>

                              <div class="line2" style="width: 100%; height: 30px; background-color: white"></div>

                              <div class="row">

                                <div class="row col-4">
                                  <label style="background-color: darkgray">Price for extra km</label>
                                  <span class="extraKm" id="extraPrice">5000</span>
                                </div>
                                <div class="row col-4">
                                  <label>Daily Rate</label>
                                  <span class="dailyRate" id="dailyRate">3000</span>
                                </div>
                                <div class="row col-4">
                                  <label style="background-color: darkgray">Monthly Rate</label>
                                  <span class="monthlyRate" id="monthlyRate">50000</span>
                                </div>

                              </div>

                              <div class="line2" style="width: 100%; height: 30px; background-color: white"></div>
                              <hr>
                              <div class="line2" style="width: 100%; height: 30px; background-color: white"></div>

                              <label style="background-color: #16a085">Customer</label>

                              <div class="line2" style="width: 100%; height: 30px; background-color: white"></div>

                              <label><h5>select date</h5></label>

                              <div class="row">

                                <div class="row col-6" style="padding: 5px">
                                  <label style="padding: 6px">Check in</label>
                                  <div class="input-group flex-nowrap">
                                    <input type="date" class="form-control datepicker" placeholder="Date" aria-label="Date" aria-describedby="addon-wrapping" name="currentDate" id="currentDate">
                                  </div>
                                </div>

                                <div class="row col-6" style="padding: 5px">
                                  <label style="padding: 6px">Check out</label>
                                  <div class="input-group flex-nowrap">
                                    <input type="date" class="form-control datepicker" placeholder="Date" aria-label="Date" aria-describedby="addon-wrapping" name="dueDate" id="dueDate">
                                  </div>
                                </div>

                              </div>

                              <div class="line2" style="width: 100%; height: 30px; background-color: white"></div>

                              <div class="row">
                              <label>luxury :</label>
                                <h6><span id="advancePayment">2000</span></h6>
                              </div>

                              <div class="col-6">
                              <label style="text-align: left; padding: 10px">conform payment by uploading slip</label>
                              <div class="input-group flex-nowrap">
                                <input type="file" class="form-control" placeholder="paymentConfirmation" aria-label="paymentConfirmation" aria-describedby="addon-wrapping" name="paymentConfirmation" id="paymentConfirmation">
                              </div>
                              </div>

                              <div class="line2" style="width: 100%; height: 30px; background-color: white"></div>

                              <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="" id="driverCheck">
                                <label class="form-check-label" for="driverCheck">
                                  Driver
                                </label>
                              </div>

                              <div class="line2" style="width: 100%; height: 30px; background-color: white"></div>

                              <div class="tot">
                                <h5 style="padding: 15px">Total :</h5>
                                <h4><span id="total">3000</span></h4>

                              </div>


                              <button type="button" class="btn btn-outline-dark" style="width: 145px" id="btnBooking">submit</button>


                            </div>

                          </div>

                          <div class="row" style="height: 10vh"></div>

                        </div>
                      </div>
                    </div>
                  </div>

                </section>
              </div>
            </div>
          </div>
        </div>
      </div>
  </div>

</section>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-3.6.1.min.js" integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous"></script>


<script>


  let baseUrl = "http://localhost:8080/Car_Rental_System_war/"

  let loginCustomer=null;
  let driver = null;

  function loadAllCarsForSelection() {
    $("#cars").empty();
    $.ajax({
      url: baseUrl + "car/getAll",
      dataType: "json",
      success: function (resp) {
        console.log(resp.data);
        resp.data.forEach((car) => {
          let {
            brand,
            model,
            fuelType,
            monthlyRate,
            dailyRate,
            vehicleNo,
          } = car;
          $("#cars").append(

                 ' <div class="col"> ' +
                   ' <div class="card" style="width: 18rem;"> ' +

                     '   <img class="col col-6" src="assest_${car.vehicleNo}.jpg" width="200" height="150">\n'+
                        '<div class="card-body"> ' +
                          '<h5 class="card-title">' +brand +" "+ model + '</h5> '+
                          '<h5 class="card-title"> Vehicle No :' +
                          '<span id="regNo">' + vehicleNo + '</span>'+
                          '</h5> '+
                          '<p class="card-text">' +fuelType+ '</p>' +
                          '<p class="card-text">dailyRate : ' +monthlyRate+ '</p>' +
                          '<p class="card-text">monthlyRate' +dailyRate+ '</p>' +
                          '<button type="button" data-bs-target="#BookingForm" data-bs-toggle="modal"  class="btn btn-primary choose">booking</a>' +
                        '</div>'+
                    '</div>' +
                  '</div>'

        );
        });


        // button functionalities
        $(".choose").click(function () {
          // is user is logged in
          if (true) {
            let regNo = $(this)
                    .parent().find("span#regNo")
                    .text();
            $.ajax({
              url: baseUrl + "car/find?vehicleNo=" + regNo,
              method: "get",
              dataType: "json",
              success: function (res) {
                let car = res.data;
                $("#BookingForm span[id]").each(function () {
                  $(this).text(car[$(this).attr("id")]);
                });
                let advance = 0.0;
                switch (car.type) {
                  case "General":
                    advance = 10000.0;
                    break;
                  case "Premium":
                    advance = 15000.0;
                    break;
                  case "Luxury":
                    advance = 20000.0;
                    break;
                }
                $("span#advancePayment").text(advance);
                // changeActiveTab("#car-single-selection");
              },
              error: function () {
                return null;
              },
            });
          } else {
            alert("please Login to proceed!");
          }
        });
      },
    });
  }

  loadAllCarsForSelection();
  function calDays() {
    let startDay = new Date($("#currentDate").val());
    let endDay = new Date($("#dueDate").val());
    var millisBetween = startDay.getTime() - endDay.getTime();
    return (totalDays = Math.round(
            Math.abs(millisBetween / (1000 * 3600 * 24))
    ));
  }
  $("#currentDate").change(calculateValueOnDateChange)
  $("#dueDate").change(calculateValueOnDateChange)

  function calculateValueOnDateChange() {
    // validating date
    let startDay = new Date($("#currentDate").val());
    let endDay = new Date($("#dueDate").val());
    let today = Date.now();
    let total = 0.0;
    if (startDay & endDay) {
      if ((startDay < endDay) & (startDay > today)) {
        try {
          var millisBetween = startDay.getTime() - endDay.getTime();
        } finally {
          let totalDays = Math.round(
                  Math.abs(millisBetween / (1000 * 3600 * 24))
          );
          let dailyRate = parseInt($("span#dailyRate").text());
          if (totalDays >= 30) {
            let monthlyRate = parseInt($("span#monthlyRate").text());
            let months = Math.round(totalDays / 30);
            let days = totalDays % 30;
            total += days * dailyRate + months * monthlyRate;
          } else {
            total += dailyRate * totalDays;
          }
          $("#driverCheck").removeAttr("disabled");
          // checking out
          if ($("#driverCheck").is(":checked")) {
            $("#driverCheck").prop("checked", false);
          }
        }
        $("span#total").text(total);
      } else {
        alert("invalid date selection, please check again");
        $(".datepicker").val("");
        $("span#total").text("");
        $("#driverCheck").prop("checked", false);
      }
    }
  }

  $("#btnBooking").click(function () {
    // var user,
    //         driver = {};
    // if ($.cookie("userLoggedIn")) {
    //   user = cookieTable["user"];
    //   console.dir(user);
    // }
    // if ($.cookie("driverAssigned")) {
    //   driver = cookieTable["driver"];
    //   console.dir(driver);
    // }
    var formData = new FormData();
    formData.append(
            "advancePayment",
            parseFloat($("span#advancePayment").text())
    );

    // let id = await generateNextId();
    formData.append("isAccepted", false);
    formData.append("bookingId", "B-001");
    formData.append("rent", parseFloat($("span#total").text()));
    formData.append("dueDateTime", $("#dueDate").val());
    formData.append("currentDateTime", $("#currentDate").val());
    formData.append("car", $("span#vehicleNo").text());
    formData.append("driver", driver.license);
    formData.append("user", "111");
    formData.append(
            "paymentConfirmation",
            $("input#paymentConfirmation")[0].files[0]
    );
    $.ajax({
      url: baseUrl + "booking/place",
      method: "post",
      data: formData,
      dataType: "json",
      success: function (res) {
        alert(res.message);
        // loadAllBookingsForUser(user.username);
      },
      error: function (error) {
        // var jsObject = JSON.parse(error.responseText);
        // alert(jsObject.message);
      },
      processData: false,
      contentType: false,
    });
  })
  // add a driver randomly
  $("input#driverCheck").change(function () {
    if ($(this).is(":checked")) {
      // get a driver randomly
      date1 = $("#currentDate").val();
      date2 = $("#dueDate").val();
      $.ajax({
        url: baseUrl + "driver/findRandom",
        method: "get",
        data: "date1=" + date1 + "&date2=" + date2,
        dataType: "json",
        success: function (res) {
          driver = res.data;
          console.log(driver)
          // $.cookie("driverAssigned", true, { path: "/" });
          // cookieTable.driver = res.data;
          // setting values
          // $("#driver-details span[id]").each(function () {
          //   $(this).text(driver[$(this).attr("id")]);
          // });
          let total = parseInt($("span#total").text());
          total += calDays() * 1000;
          $("span#total").text(total);
        },
        error: function () {
          return null;
        },
      });
    } else {
      // $.cookie("driverAssigned", false, { path: "/" });
      // $.cookie("driver", null);
      // $("#driver-details span[id]").each(function () {
      //   $(this).text("");
      // });
    }
  });
  // let customerId="";
  // $('#btnCustomerLogin').click(function(){
  //   customerId =$('#txtLoginName').val();
  //   let pw=$('#txtLoginPassword').val();
  //   $.ajax({
  //     url:baseUrl+"customer?NIC="+$('#txtLoginName').val(),
  //     dataType:"json",
  //     method: "get",
  //     async:false,
  //     success:function (res){
  //       if(customerId==res.data.nic&&pw==res.data.password){
  //         alert('login')
  //         $('#CustomerForms').css('visibility','visible')
  //     }
  //
  //     }
  //   })
  //
  // });


  // $('#btnCustomerLogin').click(function (){
  //
  //   let userName =$('#txtLoginName').val();
  //   let password = $('#txtLoginPassword').val();
  //
  //   $.ajax({
  //     url: baseUrl+"customer?NIC="+userName,
  //     dataType: "json",
  //     async:false,
  //     success:function (res) {
  //       if (password==res.data.password){
  //         loginCustomer=res.data;
  //         alert("ok;");
  //       }else {
  //         alert("invalid");
  //       }
  //     }
  //   })
  // })

  // $("#btnCustomerLogin").click(function () {
  //   console.log("called");
  //   let [uname, pwd] = [$("#txtLoginName").val(), $("#txtLoginPassword").val()];
  //   //clearLogin();
  //   $.ajax({
  //     url: baseUrl + "customer/find?username=" + uname + "&pwd=" + pwd,
  //     method: "get",
  //     dataType: "json",
  //     success: function (res) {
  //       console.log(res.data);
  //       alert(res.message);
  //       if (res.data) {
  //         // adding cookies
  //         $("userLoggedIn", true, { path: "/" });
  //         // after logged in
  //         $("#user-management-inner").hide();
  //         $("#logout").show();
  //         $("li#user").show();
  //         loadDataForUserSection(uname);
  //       } else {
  //         alert("wrong credentials");
  //       }
  //     },
  //     error: function (error) {
  //       console.log(error);
  //     },
  //   });
  // });

  $(".btn-close").on("click",()=>{$('.modal-backdrop').remove()})

</script>

</body>
</html>